<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yty.store.mapper.UserMapper">
    <resultMap id="userEntityMapper" type="com.yty.store.entity.User">
        <!-- 将表字段与类字段不一致进行匹配 -->
        <result column="is_delete" property="isDelete"></result>
        <result column="created_user" property="createdUser"></result>
        <result column="created_time" property="createdTime"></result>
        <result column="modified_user" property="modifiedUser"></result>
        <result column="modified_time" property="modifiedTime"></result>
    </resultMap>

    <!-- 添加用户 -->
    <!--
        useGeneratedKeys: 开启字段自增
        keyProperty: 指定自增字段
    -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="uid">
        INSERT INTO t_user (username,
                            password,
                            salt,
                            phone,
                            email,
                            gender,
                            avatar,
                            is_delete,
                            created_user,
                            created_time,
                            modified_user,
                            modified_time)
        values (#{username},
                #{password},
                #{salt},
                #{phone},
                #{email},
                #{gender},
                #{avatar},
                #{isDelete},
                #{createdUser},
                #{createdTime},
                #{modifiedUser},
                #{modifiedTime})
    </insert>

    <!-- 根据用户名查询用户数据 -->
    <select id="findByUserName" resultMap="userEntityMapper">
        SELECT *
        FROM t_user
        WHERE userName = #{userName}
    </select>

    <!-- 根据uid查询用户数据 -->
    <select id="findByUid" resultMap="userEntityMapper">
        SELECT *
        FROM t_user
        WHERE uid = #{uid}
    </select>

    <!-- 根据uid 修改用户密码 -->
    <update id="updatePasswordByUid">
        UPDATE t_user
        SET password     = #{password},
            modified_user = #{modifiedUser},
            modified_time = #{modifiedTime}
        WHERE uid = #{uid}
    </update>

    <!-- 根据uid 修改用户信息 -->
    <update id="updateUserInfoByUid">
        UPDATE t_user
        SET
        <if test="phone != null">
            phone = #{phone},
        </if>
        <if test="email != null">
            email = #{email},
        </if>
        <if test="gender != null">
            gender = #{gender},
        </if>
        modified_user = #{modifiedUser},
        modified_time = #{modifiedTime}
        WHERE uid = #{uid}
    </update>
    <!-- 根据uid 修改用户头像 -->
    <update id="updateAvatarByUid">
        UPDATE t_user
        SET avatar        = #{avatar},
            modified_user = #{modifiedUser},
            modified_time = #{modifiedTime}
        WHERE uid = #{uid}
    </update>
</mapper>